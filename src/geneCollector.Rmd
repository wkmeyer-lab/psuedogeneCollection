---
title: "brainstorming"
output: pdf_document
date: "2025-06-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Debugging:

-   Task 1 issues:

    -   I am unsure why keys are printing to console

-   Task 2 issues:

    -   Merge returns a 2 column data frame, but I only want one column per species.

        -   solution: Remove duplicate rows that have no species for row 1

    -   

## Preparing genes for analysis

```{r}

library(stringr)
library(readr)
library(dplyr)

#geneCollector accesses and cleans loss_summ_data for each species to be examined. Then, it  
geneCollector <- function(){
  # Access losssum.tsv
  setwd("~/meyerLab/psuedogeneCollector/data")
  files <- list.files(
    path = ".", # "~/meyerLab/psuedogeneCollector/data", 
    recursive=TRUE, 
    pattern = "loss_summ_data",
    full.names=TRUE)
  
  species_gene <- grabData(files)
  genes <- updateUniqueGenes(species_gene)
  mergeData(species_gene, genes)
  return(list(species_gene = species_gene, genes = genes))
}

#' Obtains and cleans loss_summ_data
#' @param files --> Vector containing absolute paths to every instance of loss_summ_data
#' @return A list formatted as a dictionary --> key = character (species name), value = df (clean loss_summ_data)
#' @author Tyler gruver
grabData <- function(files){
  species_gene <- list() #key == species name, value == .tsv file containing losssum data
   counter <- 0

  for(i in 1:length(files)){
    temp <- str_locate_all(files[i], "/")[[1]] #temp returns a list of matrixes. [[1]] grabs the matrix  at position 1... temp will only ever be a list of length 1 
    
    counter <- counter + 1
    if(counter > 5) break

    #Setting key-value pairs
    name <- substring(files[i], temp[3, 1] +1 , temp[4, 1] -1)
    key <- paste("Key: ", name , sep = " ")
    value <- cleanData(files[i]) #returns clean .tsv
    species_gene[[key]] <- value
  }  
  

  return(species_gene)
}

#' cleans loss_summ_data
#' @param f --> Vector containing absolute paths to a single instance of loss_summ_data
#' @return A df --> Clean loss_summ_data
#' @author Tyler gruver
cleanData <- function(f){
  df <- read_tsv(f, show_col_types = FALSE)
  clean_df <- df[df$PROJECTION == "GENE",]
  return(clean_df[, -1])
}

#' Creates a list of unique genes seen under every instance of loss_summ_data
#' @param files --> Vector containing absolute paths to a single instance of loss_summ_data 
#' @return A list containing every unique gene under every instance of loss_summ_data
#' @author Tyler gruver    
updateUniqueGenes <- function(species_gene){
  genes <- character(length=0)
  cleanListOfAllGenes <- getGenesFromSpecies(species_gene)
  
     counter = 0

  
  for(genesList in cleanListOfAllGenes) {
    counter <- counter + 1
    genes <- union(genes, genesList)  # performs set union operation on genes character vector AND df[,1] column subset.

        if(counter > 5) break

  }
  
  return(genes)
}

getGenesFromSpecies <- function(species_gene, genes){
  listOfAllGenes<- unname(species_gene)
  return(listOfAllGenes[[1]][,1])
}

mergeData <- function(sg, genes){

   df_merged <- data.frame(species = genes)
   
for (i in seq_along(sg)) {
  species_df <- sg[[i]]             # tibble: gene + presence
  colnames(species_df) <- c("gene", "label")

  merged <- merge(df_merged, species_df, by.x = "species", by.y = "gene", all.x = TRUE)

  # Save label column and rename it to species
  df_merged[[ names(sg)[i] ]] <- merged$label
}
   
   View(df_merged)
  
}


var1 <- geneCollector()
```

# Task 2:

Create a new .tsv file.\
Add a col for every species

Add a row for every gene in genes

For every species, check for matches between every gene in their data frame for a match in genes. If a match is found, place element in df[species name, gene found]

```         
```

-   COL 2 should contain all gene names. Look through every gene name. For every new gene, append that gene to the list that stores genes.Â 
